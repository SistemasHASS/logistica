<div class="requerimiento_consumo-container">
    <!-- <div class="requerimiento_consumo-header">
        <div>
            <h6>Fecha: {{ fecha | date: 'yyyy-MM-dd' }}</h6>
        </div>
        <div class="empresa-info">
            <span class="empresa">{{ usuario?.razonSocial }}</span>
            <span class="fecha">{{ fecha | date: 'yyyy-MM-dd' }}</span>
        </div>
    </div> -->

    <div class="requerimiento_consumo-form">
        <div class="row g-3">
            <div class="col-6">
                <label>Fundo <span class="text-danger">*</span></label>
                <select class="form-select" [(ngModel)]="fundoSeleccionado">
                    <option value="">Seleccione un fundo</option>
                    <option *ngFor="let f of fundos" [value]="f.nombreFundo">{{f.nombreFundo}}</option>
                </select>
            </div>

            <div class="col-6">
                <label>Área <span class="text-danger">*</span></label>
                <select class="form-select" [(ngModel)]="areaSeleccionada">
                    <option value="">Seleccione un turno</option>
                    <option *ngFor="let a of areas" [value]="a.idarea">{{a.descripcion}}</option>
                </select>
            </div>

            <div class="col-6">
                <label>Almacén <span class="text-danger">*</span></label>
                <select class="form-select" [(ngModel)]="almacenSeleccionado">
                    <option value="">Seleccione un almacen</option>
                    <option *ngFor="let a of almacenes" [value]="a.idalmacen">{{ a.almacen }}</option>
                </select>
            </div>

            <div class="col-6">
                <label>Clasificación <span class="text-danger">*</span></label>
                <select class="form-select" [(ngModel)]="clasificacionSeleccionado">
                    <option value="">Seleccione un clasificación</option>
                    <option *ngFor="let c of clasificaciones" [value]="c.idclasificacion">{{ c.descripcion_clasificacion
                        }}</option>
                </select>
            </div>

            <!-- Glosa -->
            <div class="mb-3">
                <label for="glosa" class="form-label fw-semibold">Glosa</label>
                <textarea id="glosa" class="form-control" rows="3" [(ngModel)]="glosa"
                    placeholder="Escriba aquí la glosa..."></textarea>
            </div>

            <!-- Botón agregar detalle -->
            <div class="d-flex justify-content-end mb-3">
                <button class="btn btn-primary" (click)="abrirModal()">
                    <i class="bi bi-plus-circle me-1"></i> Agregar línea detalle
                </button>
            </div>

            <!-- Tabla -->
            <div class="table-responsive">
                <table class="table table-bordered table-striped align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Código</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Proyecto</th>
                            <th>CECO</th>
                            <th>Turno</th>
                            <th>Labor</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of detalles; let i = index">
                            <td>{{ item.codigo }}</td>
                            <td>{{ item.producto }}</td>
                            <td>{{ item.cantidad }}</td>
                            <td>{{ item.proyecto }}</td>
                            <td>{{ item.ceco }}</td>
                            <td>{{ item.turno }}</td>
                            <td>{{ item.labor }}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-2" (click)="editarLinea(i)">
                                    <i class="icon-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" (click)="eliminarLinea(i)">
                                    <i class="icon-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr *ngIf="detalles.length === 0">
                            <td colspan="8" class="text-muted">No hay detalles agregados</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Modal de edición -->
            <!-- Modal -->
            <div class="modal-backdrop" *ngIf="modalAbierto">
                <div class="modal-content">
                    <!-- <h5>Registrar Línea de Detalle</h5>     -->
                    <h5>{{ editIndex >= 0 ? 'Editar Línea de Detalle' : 'Agregar Línea de Detalle' }}</h5>

                    <div class="form-group">
                        <div class="row g-3">
                            <!-- <div class="col-6">
                                <label>Código</label>
                                <input type="text" class="form-control" [(ngModel)]="lineaTemp.codigo" readonly />
                            </div> -->
                            <!-- Campo CODIGO oculto -->
                            <input type="hidden" [(ngModel)]="lineaTemp.codigo" name="codigo" />
                            <div class="col-6">
                                <label>Producto <span class="text-danger">*</span></label>
                                <select class="form-select" [(ngModel)]="lineaTemp.producto">
                                    <option value="">Seleccione un producto</option>
                                    <option *ngFor="let it of items" [value]="it.descripcion">{{ it.descripcion }}
                                    </option>
                                </select>
                            </div>

                            <div class="col-6">
                                <label>Cantidad <span class="text-danger">*</span></label>
                                <input type="number" class="form-control cantidad" [(ngModel)]="lineaTemp.cantidad"
                                    min="1" />
                            </div>

                            <div class="col-6">
                                <label>Proyecto <span class="text-danger">*</span></label>
                                <select class="form-select" [(ngModel)]="lineaTemp.proyecto">
                                    <option value="">Seleccione un proyecto</option>
                                    <option *ngFor="let p of proyectos" [value]="p.proyectoio">{{ p.proyectoio }}
                                    </option>
                                </select>
                            </div>

                            <div class="col-6">
                                <label>CECO <span class="text-danger">*</span></label>
                                <select class="form-select" [(ngModel)]="lineaTemp.ceco">
                                    <option value="">Seleccione un ceco</option>
                                    <option *ngFor="let c of cecos" [value]="c.localname">{{ c.localname }}</option>
                                </select>
                            </div>

                            <div class="col-6">
                                <label>Turno <span class="text-danger">*</span></label>
                                <select class="form-select" [(ngModel)]="lineaTemp.turno">
                                    <option value="">Seleccione un turno</option>
                                    <option *ngFor="let t of turnos" [value]="t.nombreTurno">{{ t.nombreTurno }}
                                    </option>
                                </select>
                            </div>

                            <div class="col-6">
                                <label>Labor <span class="text-danger">*</span></label>
                                <select class="form-select" [(ngModel)]="lineaTemp.labor">
                                    <option value="">Seleccione un labor</option>
                                    <option *ngFor="let l of labores" [value]="l.labor">{{ l.labor }}</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-4 text-center">
                            <button class="btn btn-success me-2" (click)="guardarLinea()">Guardar</button>
                            <button class="btn btn-danger" (click)="cerrarModal()">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3">
            <button class="btn btn-success me-2" (click)="guardar()">Guardar</button>
            <button class="btn btn-danger m-2" (click)="cancelar()">Cancelar</button>
        </div>
    </div>
</div>