<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#aprobados">Aprobados</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#rechazados">Rechazados</a>
    </li>
</ul>

<div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="aprobados">
        <p-table [value]="aprobados" class="p-table-sm" [paginator]="true" [rows]="20" [totalRecords]="aprobados.length"
            responsiveLayout="scroll" [pageLinks]="5" [showCurrentPageReport]="true" styleClass="custom-table"
            [showGridlines]="false" currentPageReportTemplate="<{first} - {last} de {totalRecords}>">
            <ng-template pTemplate="header">
                <tr>
                    <th>N° Req</th>
                    <th>N° Requisición</th>
                    <th>Descripcion</th>
                    <th>Aprobador</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                    <th>Tipo Requerimiento</th>
                    <th>Observación</th>
                    <th>Acciones</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-row>
                <tr>
                    <td>{{ obtenerIdReq(row.idrequerimiento)}}</td>
                    <td><strong>{{ row.RequisicionNumero || '-' }}</strong></td>
                    <td>{{ row.glosa }}</td>
                    <td>{{ row.dniAprobador }}</td>
                    <td>
                        <span class="badge-estado aprobado" *ngIf="row.estado == 1">Aprobado</span>
                    </td>
                    <td>{{ row.fechaAprobacion | date:'dd/MM/yyyy' }}</td>
                    <td>{{ row.tipo}}</td>
                    <td>{{ row.observacion }}</td>
                    <td>
                        <button class="btn btn-info btn-sm" (click)="verDetalle(row)" title="Ver Detalle">
                            <i class="icon icon-eye"></i> Ver
                        </button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <div class="tab-pane fade" id="rechazados">
        <p-table [value]="rechazados" class="p-table-sm" [paginator]="true" [rows]="20" [totalRecords]="rechazados.length"
            responsiveLayout="scroll" [pageLinks]="5" [showCurrentPageReport]="true" styleClass="custom-table"
            [showGridlines]="false" currentPageReportTemplate="<{first} - {last} de {totalRecords}>">
            <ng-template pTemplate="header">
                <tr>
                    <th>N° Req</th>
                    <th>N° Requisición</th>
                    <th>Descripcion</th>
                    <th>Aprobador</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                    <th>Tipo Requerimiento</th>
                    <th>Observación</th>
                    <th>Acciones</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-row>
                <tr>
                    <td>{{ obtenerIdReq(row.idrequerimiento)}}</td>
                    <td><strong>{{ row.RequisicionNumero || '-' }}</strong></td>
                    <td>{{ row.glosa }}</td>
                    <td>{{ row.dniAprobador }}</td>
                    <td>
                        <span class="badge-estado rechazado" *ngIf="row.estado == 1">Rechazado</span>
                    </td>
                    <td>{{ row.fechaAprobacion | date:'dd/MM/yyyy' }}</td>
                    <td>{{ row.tipo}}</td>
                    <td>{{ row.observacion }}</td>
                    <td>
                        <button class="btn btn-info btn-sm" (click)="verDetalle(row)" title="Ver Detalle">
                            <i class="icon icon-eye"></i> Ver
                        </button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<!-- MODAL DETALLE REQUERIMIENTO -->
<p-dialog header="Detalle del Requerimiento" [(visible)]="displayDetalle" [modal]="true" 
    [style]="{ width: '90vw' }" [closable]="true">
    
    <div class="mb-3" *ngIf="requerimientoSeleccionado">
        <div class="row">
            <div class="col-md-3">
                <strong>N° Req:</strong> {{ obtenerIdReq(requerimientoSeleccionado.idrequerimiento) }}
            </div>
            <div class="col-md-3">
                <strong>N° Requisición:</strong> {{ requerimientoSeleccionado.RequisicionNumero || '-' }}
            </div>
            <div class="col-md-3">
                <strong>Fecha Aprobación:</strong> {{ requerimientoSeleccionado.fechaAprobacion | date: 'dd/MM/yyyy' }}
            </div>
            <div class="col-md-3">
                <strong>Aprobador:</strong> {{ requerimientoSeleccionado.dniAprobador }}
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-6">
                <strong>Descripción:</strong> {{ requerimientoSeleccionado.glosa }}
            </div>
            <div class="col-md-3">
                <strong>Tipo:</strong> {{ requerimientoSeleccionado.tipo }}
            </div>
            <div class="col-md-3">
                <strong>Observación:</strong> {{ requerimientoSeleccionado.observacion || '-' }}
            </div>
        </div>
    </div>

    <p-table [value]="detalleRequerimiento" responsiveLayout="scroll" styleClass="p-datatable-sm p-datatable-striped"
        [loading]="loadingDetalle">
        <ng-template pTemplate="header">
            <tr>
                <th style="width:50px">#</th>
                <th style="min-width:100px">Código</th>
                <th style="min-width:200px">Descripción</th>
                <th style="min-width:80px">Cantidad</th>
                <th style="min-width:80px">Unidad</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-d let-i="rowIndex">
            <tr>
                <td>{{ i + 1 }}</td>
                <td>{{ d.codigo }}</td>
                <td>{{ d.descripcion || d.iddescripcion }}</td>
                <td>{{ d.cantidad }}</td>
                <td>{{ d.unidad || 'UND' }}</td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5" class="text-center">No hay detalle</td>
            </tr>
        </ng-template>
    </p-table>

    <ng-template pTemplate="footer">
        <button class="btn btn-secondary" (click)="cerrarDetalle()">Cerrar</button>
    </ng-template>
</p-dialog>